name: publish website

on:
  push:
    branches: [ src ]
  pull_request:
    branches: [ src ]

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout 🛎️
      uses: actions/checkout@v2
    - name: Set up Ruby 🧱
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: 2.6
        bundler-cache: true
    - name: Install dependencies 🧱
      run: bundle install
    - name: Run Middleman 🔧
      run: bundle exec middleman build
    - name: Deploy to GitHub Pages 🚀
      uses: JamesIves/github-pages-deploy-action@3.7.1
      if: github.ref == 'refs/heads/src'
      with:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        BRANCH: master
        FOLDER: build
